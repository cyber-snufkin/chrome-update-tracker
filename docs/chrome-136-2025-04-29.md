# 🧭 Chrome 136 更新チェック（Stable＋コードサンプル付き）

- リリース日: 2025-04-29（Stable）
- 一次情報:
  - [Release Notes](https://developer.chrome.com/release-notes/136)
  - [New in Chrome 136](https://developer.chrome.com/blog/new-in-chrome-136/)
  - [Chrome Releases: Stable Channel Update for Desktop (Apr 29, 2025)](https://chromereleases.googleblog.com/2025/04/stable-channel-update-for-desktop_29.html)
  - [ChromeStatus Roadmap](https://chromestatus.com/roadmap)
  - [MDN](https://developer.mozilla.org/ja/docs/Web) / [Can I use](https://caniuse.com/)
  - [Baseline](https://web.dev/baseline?hl=ja)

---

## 🔹 全体サマリ
- **`RegExp.escape()`** が実装、**Baseline: Newly available** に（安全な正規表現リテラル生成）
- **`:visited` の履歴パーティション**（同一トップレベルサイト＆フレーム origin に限定）
- **既存のパスワード資格情報をパスキーへアップグレード**
- **CanvasTextDrawingStyles に `lang`**（`OffscreenCanvas` でも言語別の字形選択を統一）
- **CSS `dynamic-range-limit`**（HDR最大輝度の上限。**仕様準拠の値記法に更新**）
- セキュリティ修正（CVE含む）もリリースノートで告知

### 🚨 重要度の高いもの
- **`RegExp.escape()`** により、ユーザー入力文字列の正規表現埋め込みが安全・簡潔に
- **`:visited` パーティション**で履歴リーク耐性が強化（スタイル条件の見直しが必要な場合あり）
- **パスワード→パスキー移行**のUI/フロー対応（資格情報管理UIと合わせて確認推奨）

---

## 🧩 HTML / DOM
### CanvasTextDrawingStyles に `lang`（`OffscreenCanvas` 含む）
```js
// 画面外でテキストを描画する際も、言語に応じた字形選択を統一
const off = new OffscreenCanvas(600, 200);
const ctx = off.getContext('2d');

// ここで言語タグを指定（BCP 47）。日本語の字形優先選択などに利用。
ctx.lang = 'ja';
ctx.font = '24px system-ui';
ctx.fillText('漢字の字形選択を統一', 10, 40);
```
> 仕様: `CanvasTextDrawingStyles.lang`。メインCanvasと描画差が出ないよう制御可能。

---

## 🎨 CSS
### `dynamic-range-limit`（HDR 最大輝度の上限）
```css
@media (dynamic-range: high) {
  img, video, canvas {
    dynamic-range-limit: constrained-high; /* HDRピークを抑えて白飛びを防止 */
  }
}
```
> 値は数値（nits）ではなく**キーワード**（`standard`/`high`/`constrained-high`）または `dynamic-range-limit-mix()` 関数を使用。

---

## ⚙️ JavaScript (V8)
### `RegExp.escape()`（Baseline: Newly available）
```js
// ユーザー入力を安全に正規表現に埋め込む
const user = '(a+b)?*[';
const safe = RegExp.escape(user); // "\(a\+b\)\?\*\[" のように、各メタ文字を個別にバックスラッシュでエスケープした文字列を返す
const re = new RegExp(safe);
console.log(re.test('(a+b)?*[')); // true
```

### `:visited` の履歴パーティション
```css
/* 136以降、同一トップレベルサイト&フレームoriginで訪問済みのリンクのみ :visited になる */
a:visited { color: rebeccapurple; }
```
> 既存サイトで :visited の適用条件に依存したUIがある場合、視覚差異が生じないか確認を。

### 既存パスワード→パスキーへのアップグレード
```js
// Credential Management / WebAuthn の実装例のイメージ（擬似コード）
const cred = await navigator.credentials.get({ password: true });
if (cred) {
  // サーバー側でパスキー（PublicKeyCredential）発行手続きを促す
  // 実際には WebAuthn の create()/get() を用いた登録/認証フローに移行
}
```
> 実装はバックエンドの登録/検証ロジック（WebAuthn）とセットで。UIガイダンスのアップデート推奨。

---

## 🧠 AI in Chrome
- 本版での新規APIは目立たないが、DevTools 側のAI支援（後述）と合わせて検証。

---

## 🧰 DevTools
- **本ドキュメントは Chrome 136 の範囲**です。将来の更新（137–138）の情報は**参考**として別途まとめる方針。
- 136の主な改善例:
  - 自動ワークスペース検出
  - CSS corner-shape 等の補完・デバッグ改善
  - Privacy & Security パネルの強化、Network の Server-Timing 表示の改善 など

```text
Tips: 136 では Recorder/Performance/Network 各ツールのUI改善が進んでいます。
```

---

## 🌐 Web API（その他）
- （該当なし／上記に包含）

---

## 🧾 セキュリティ更新
- 8件のセキュリティ修正。重大度 High 1件（CVE-2025-4096 ほか）。詳細は Chrome Releases を参照。

---

### 導入指針メモ
- **テキスト描画**: `ctx.lang` で `OffscreenCanvas` の字形差異を抑止
- **フォーム/認証**: パスキー移行のUIとサーバ実装（WebAuthn）を段階導入
- **正規表現**: ユーザー入力は `RegExp.escape()` 前提に（XSS/DoS予防に寄与）
- **スタイル**: `:visited` 条件変更の影響監視。E2E可視性テストを更新
