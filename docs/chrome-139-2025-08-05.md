# 🧭 Chrome 139 更新チェック（Stable＋コードサンプル付き）

- リリース日: 2025-08-05（Stable）
- 一次情報:
  - [Release Notes](https://developer.chrome.com/release-notes/139?hl=ja)
  - [New in Chrome 139](https://developer.chrome.com/blog/new-in-chrome-139?hl=ja)
  - [New in DevTools 139](https://developer.chrome.com/blog/new-in-devtools-139?hl=ja)
  - [ChromeStatus Roadmap](https://chromestatus.com/roadmap)
  - [MDN](https://developer.mozilla.org/ja/docs/Web) / [Can I use](https://caniuse.com/)
  - [Baseline](https://web.dev/baseline?hl=ja)

---

## 🔹 全体サマリ
- CSS: `@function` ルールによるカスタム関数定義と、`corner-shape` / `squircle` による高度な角のスタイリングが可能に。
- Web API: オンデバイス音声認識 API でプライバシー配慮の音声処理を実現。Web Speech API のローカル版として提供。
- AI in Chrome: Prompt API（Origin Trial）でローカル AI モデルとの連携を試験提供。テキスト・画像・音声入力に対応。
- セキュリティ: Accept-Language ヘッダーの削減と window.name のクロスサイトクリアでフィンガープリント対策を強化。
- Web アプリ: `scope_extensions` マニフェストフィールドで複数オリジンを単一 PWA として統合可能に。
- DevTools: AI アシスタントで画像アップロード機能を追加。ネットワークパネルでリクエストヘッダーの列追加が可能に。

### 🚨 重要度の高いもの
- **CSS カスタム関数（@function）** によるパラメータ化されたスタイル定義
- **Corner Shape（squircle）** で iOS 風の滑らかな角を実装可能
- **オンデバイス音声認識** でプライバシー配慮の音声処理が標準化
- **Prompt API（OT）** でローカル AI モデルとの連携を試験運用
- **セキュリティ強化**（Accept-Language、window.name）でフィンガープリント削減
- **scope_extensions** で複数ドメインを単一 PWA として運用可能

---

## 🧭 新用語リファレンス（Glossary）

> 本Glossaryは Chrome 139 で新登場または重要化した技術用語の一覧です。

| 用語 | 概要 | 関連領域 |
|------|------|-----------|
| **CSS カスタム関数（@function）** | `@function` ルールでパラメータと条件に基づいて動的に値を返す関数を定義。CSS Mixins 仕様の一部。 | CSS |
| **Corner Shape（角の形状）** | `corner-shape` プロパティで border-radius を超える角のスタイリング。squircle、superellipse、notch、scoop などに対応。 | CSS |
| **Squircle（スクエアクル）** | 正方形と円の中間形状。スーパー楕円の一種で、iOS 風の滑らかな角を実現。 | CSS / デザイン |
| **オンデバイス音声認識** | Web Speech API のローカル処理版。音声データを外部送信せずデバイス上で音声認識を実行。 | Web API / プライバシー |
| **Prompt API（OT）** | ローカル AI モデル（Gemini Nano 相当）と連携する実験的 API。テキスト・画像・音声入力に対応。 | AI / Origin Trial |
| **scope_extensions** | Web App Manifest の新フィールド。複数オリジン（サブドメインや別ドメイン）を単一 PWA として統合。Chrome 139 で正式実装。 | Web アプリ |
| **request-close コマンド** | `<dialog>` 要素の閉じる動作を制御する宣言型 API。`commandfor` 属性と組み合わせて使用。 | HTML / DOM |
| **window.name クリア** | クロスサイトナビゲーション時に window.name を自動クリアし、追跡ベクトルを削減。 | セキュリティ |

---

## 🧩 HTML
- **`request-close` 呼び出しコマンド**: `<dialog>` 要素の閉じる動作を宣言的に制御可能に。`commandfor` 属性と組み合わせて使用。[ChromeStatus](https://chromestatus.com/feature/5592399713402880)
- **SVG `<script>` 要素の async 属性**: SVG 2.0 に準拠し、非同期スクリプト実行が可能に。[ChromeStatus](https://chromestatus.com/feature/6114615389585408)
- **JavaScript DOM API での文字数制限緩和**: HTML パーサーに合わせて要素名・属性名の検証を緩和。[ChromeStatus](https://chromestatus.com/feature/6278918763708416)
- サンプル：
  ```html
  <!-- request-close コマンドで dialog を閉じる -->
  <button commandfor="my-dialog" command="request-close">閉じる</button>
  <dialog id="my-dialog">
    <h2>確認ダイアログ</h2>
    <p>この操作を実行しますか？</p>
    <button commandfor="my-dialog" command="request-close">キャンセル</button>
  </dialog>

  <!-- SVG script の async 属性 -->
  <svg xmlns="http://www.w3.org/2000/svg">
    <script async href="animation.js"></script>
    <circle cx="50" cy="50" r="40" fill="oklch(60% 0.2 240)" />
  </svg>
  ```

---

## 🎨 CSS
- **CSS カスタム関数（@function）**: パラメータと条件に基づいて動的に値を返す関数を定義可能に。CSS Mixins 仕様の一部。[ChromeStatus](https://chromestatus.com/feature/5179721933651968)
- **Corner Shape（角の形状）**: `corner-shape` プロパティで squircle、superellipse、notch、scoop などの複雑な角をスタイリング。アニメーション対応。[ChromeStatus](https://chromestatus.com/feature/5357329815699456)
- **`var()` / `attr()` ショートカット**: フォールバック不使用時の評価処理を最適化。[ChromeStatus](https://chromestatus.com/feature/6212939656462336)
- **`@font-face` の `font-feature-settings` ディスクリプタ**: CSS Fonts Level 4 準拠でタイポグラフィ制御を改善。[ChromeStatus](https://chromestatus.com/feature/5102801981800448)
- **遷移プロパティの動作改善**: Safari/Firefox とアクティブトランジションの一貫性を確保。[ChromeStatus](https://chromestatus.com/feature/5194501932711936)
- サンプル：
  ```css
  /* CSS カスタム関数 */
  @function --theme-color(--variant) {
    result: if(style(--variant: primary): oklch(60% 0.2 240);
               style(--variant: secondary): oklch(70% 0.15 120);
               else: oklch(50% 0.1 0));
  }

  .button {
    --variant: primary;
    background: --theme-color(var(--variant));
    color: white;
    padding: 0.75rem 1.5rem;

    /* squircle で iOS 風の角 */
    corner-shape: squircle;
    border-radius: 16px;
  }

  .card {
    width: 200px;
    height: 200px;
    background: oklch(85% 0.1 220);

    /* スーパー楕円のカスタムパラメータ */
    corner-shape: superellipse 0.65;
    border-radius: 32px;
  }

  /* 従来の border-radius との比較 */
  .traditional {
    border-radius: 32px; /* 円形の角 */
  }

  .modern {
    corner-shape: squircle;
    border-radius: 32px; /* より滑らかで有機的な角 */
  }
  ```

---

## ⚙️ JavaScript (V8) / Web API
- **オンデバイス音声認識 API**: Web Speech API のローカル処理版。音声データを外部送信せずデバイス上で認識処理。プライバシー配慮の音声処理を実現。[ChromeStatus](https://chromestatus.com/feature/6090916291674112)
- **`scope_extensions` マニフェストフィールド**: 複数オリジン（サブドメインや別ドメイン）を単一 PWA として統合可能に。[ChromeStatus](https://chromestatus.com/feature/5746537956114432)
- **JSON MIME タイプの仕様準拠検出**: `+json` で終わる MIME タイプ（例: `application/vnd.api+json`）を正しく認識。WHATWG mimesniff 仕様に準拠。[ChromeStatus](https://chromestatus.com/feature/5470594816278528)
- **WebGPU `core-features-and-limits`**: アダプタとデバイスがコア機能をサポートすることを明示的に示す機能。[ChromeStatus](https://chromestatus.com/feature/4744775089258496)
- **WebGPU: BC / ASTC 圧縮形式の 3D テクスチャサポート**: BC（Block Compression）と ASTC（Adaptive Scalable Texture Compression）形式の 3D テクスチャに対応。[ChromeStatus](https://chromestatus.com/feature/5080855386783744)
- **Crash Reporting API: `crash-reporting` エンドポイント**: クラッシュレポートを専用エンドポイントで分別送信可能に。[ChromeStatus](https://chromestatus.com/feature/5129218731802624)
- サンプル：
  ```javascript
  // オンデバイス音声認識の利用可能性確認
  const isAvailable = await SpeechRecognition.available({
    langs: ['ja-JP'],
    processLocally: true
  });

  if (isAvailable) {
    // ローカル処理での音声認識を開始
    const recognition = new webkitSpeechRecognition();
    recognition.lang = 'ja-JP';
    recognition.processLocally = true; // オンデバイス処理を指定
    recognition.continuous = false;

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      console.log('認識結果:', transcript);
    };

    recognition.onerror = (event) => {
      console.error('認識エラー:', event.error);
    };

    recognition.start();
  } else {
    // 言語モデルのインストールが必要な場合
    await SpeechRecognition.install({ langs: ['ja-JP'], processLocally: true });
    // または、クラウド版にフォールバック
    console.log('オンデバイス音声認識は利用できません。クラウド版を使用します。');
  }
  ```

  ```json
  // scope_extensions マニフェスト例（manifest.json）
  {
    "name": "My Multi-Origin App",
    "scope": "/app/",
    "start_url": "/app/",
    "scope_extensions": [
      {
        "origin": "https://subdomain.example.com"
      },
      {
        "origin": "https://another-domain.com",
        "has_origin_wildcard": true
      }
    ]
  }
  ```

  ```javascript
  // WebGPU core-features-and-limits 確認
  const adapter = await navigator.gpu.requestAdapter();
  if (adapter.features.has('core-features-and-limits')) {
    console.log('コア機能がサポートされています');
  }
  ```

---

## 🧠 AI in Chrome
- **Prompt API（Origin Trial）**: ローカル AI モデル（Gemini Nano 相当）と連携する実験的 API。テキスト・画像・音声入力に対応。プライバシー配慮のオンデバイス推論を実現。[Origin Trial 登録](https://developer.chrome.com/origintrials/?hl=ja#/register_trial/2533837740349325313)
- **ライフタイムが延長された共有ワーカー（Origin Trial）**: `extendedLifetime: true` オプションでページ閉鎖後もワーカーを継続実行可能に。バックグラウンド処理の持続性を向上。[Origin Trial 登録](https://developer.chrome.com/origintrials/?hl=ja#/register_trial/3056255297124302849)
- サンプル：
  ```javascript
  // Prompt API の使用例（Origin Trial 登録が必要）
  if ('ai' in window && 'languageModel' in window.ai) {
    const session = await window.ai.languageModel.create({
      systemPrompt: "あなたは親切なプログラミングアシスタントです。",
      temperature: 0.7,
      topK: 3
    });

    const result = await session.prompt(
      "JavaScriptの配列操作で map と forEach の違いを簡潔に説明してください"
    );
    console.log(result);

    // セッションのクリーンアップ
    session.destroy();
  }
  ```

  ```javascript
  // ライフタイム延長共有ワーカー（Origin Trial）
  const worker = new SharedWorker('processor.js', {
    name: 'background-processor',
    extendedLifetime: true // ページ閉鎖後も継続
  });

  worker.port.postMessage({ task: 'start-monitoring' });
  ```

---

## 🧰 DevTools
- **AI アシスタントでの画像アップロード機能**: Elements パネルから会話を開始し、任意の画像をアップロードして視覚的コンテキストを追加可能に。スタイリング関連の質問がより効果的に。[DevTools 139](https://developer.chrome.com/blog/new-in-devtools-139?hl=ja)
- **ネットワークパネルのリクエストヘッダー列追加**: リクエストテーブルに複数のリクエストヘッダーを列として追加可能に。ネットワークデバッグの効率化。
- **品質改善**: 未解決の問題が 27% 減少、テスト関連問題は 54% 削減。長年の視覚的不具合やデザイン不整合を改善。
- **パフォーマンス分析改善**: レイアウトシフトの原因分析、LCP リクエスト検出の改善、スロットリング設定の修正。
- **アプリケーションパネル**: IndexedDB オブジェクトストアをクリアする際の確認ダイアログを追加。
- **ソースパネル**: ログポイントと条件付きブレークポイントのバッジにツールチップを表示。

---

## 🔒 セキュリティ
- **Accept-Language ヘッダーのフィンガープリント削減**: 最優先言語のみ送信し、詳細な言語設定の流出を防止。ユーザートラッキングのリスク軽減。[ChromeStatus](https://chromestatus.com/feature/5188040623390720)
- **window.name のクロスサイトクリア**: クロスサイトナビゲーション時に window.name を自動クリアし、追跡ベクトルとしての情報漏洩を防止。[ChromeStatus](https://chromestatus.com/feature/5962406356320256)
- **CSP でブロックされた Worker のエラーイベント**: Content Security Policy 違反時に例外スローではなく非同期的にエラーイベントを発生。[ChromeStatus](https://chromestatus.com/feature/5177205656911872)
- **安全なお支払い確認（SPC）関連**:
  - `securePaymentConfirmationAvailability` API で SPC の利用可能性を簡単に確認可能に。[ChromeStatus](https://chromestatus.com/feature/5165040614768640)
  - SPC ブラウザバウンドキーでデバイスバインディング要件に対応した暗号署名を実現。[ChromeStatus](https://chromestatus.com/feature/5106102997614592)
- **Windows での TCP ポート割り当てランダム化**: ポート再利用問題を軽減する安全な実装。[ChromeStatus](https://chromestatus.com/feature/5106900286570496)
- サンプル：
  ```javascript
  // 変更は自動適用されるため、開発者側での実装は不要
  // ただし、window.name に依存した実装がある場合は影響を確認

  // 従来の window.name による状態管理（非推奨）
  window.name = JSON.stringify({ userId: 123 });

  // Chrome 139 以降はクロスサイトナビゲーション時にクリアされる
  // 代替手段: sessionStorage や localStorage を使用
  sessionStorage.setItem('appState', JSON.stringify({ userId: 123 }));
  ```

---

## 📱 Web アプリ
- **`scope_extensions` マニフェストフィールド**: 複数サブドメインやトップレベルドメイン配下のサイトを単一 PWA として統合可能に。認証状態やナビゲーションを共有。[ChromeStatus](https://chromestatus.com/feature/5746537956114432)
- サンプル：
  ```json
  {
    "name": "Enterprise Portal",
    "short_name": "Portal",
    "scope": "/",
    "start_url": "/dashboard",
    "scope_extensions": [
      {
        "origin": "https://admin.example.com"
      },
      {
        "origin": "https://api.example.com"
      },
      {
        "origin": "https://docs.example.com",
        "has_origin_wildcard": true
      }
    ],
    "display": "standalone",
    "theme_color": "#4285f4"
  }
  ```

---

## 🪶 その他
- **WebXR Depth Sensing のパフォーマンス改善**: デプスバッファ生成・消費のカスタマイズ機能を追加。XR アプリケーションの効率化。[ChromeStatus](https://chromestatus.com/feature/5074096916004864)
- **WebRTC エンコードフレームの音声レベル**: WebRTC エンコード変換経由で音声レベルを公開。音声処理の可視化が容易に。[ChromeStatus](https://chromestatus.com/feature/5206106602995712)
- **Android バックグラウンドフリーズ高速化**: フリーズ開始時間を 5 分から 1 分に短縮。メモリ効率とバッテリー消費を改善。[ChromeStatus](https://chromestatus.com/feature/5386725031149568)
- **Origin Trial**:
  - **Web 認証の即時仲介**: ログイン UI をスキップして認証情報を即座に確認。[ChromeStatus](https://chromestatus.com/feature/5164322780872704)
  - **フルフレームレートレンダリングブロック属性**: 読み込み時の低フレームレート動作を制御。[ChromeStatus](https://chromestatus.com/feature/5207202081800192)
  - **WebGPU 互換モード**: OpenGL/Direct3D11 など古いグラフィック API に対応。[ChromeStatus](https://chromestatus.com/feature/6436406437871616)
  - **SoftNavigation パフォーマンスエントリ**: ソフトナビゲーション測定機能の試験運用。[Origin Trial](https://developer.chrome.com/origintrials?hl=ja#/view_trial/21392098230009857)

### 🗑️ 非推奨・削除
- **macOS 11 のサポート終了**: Chrome 139 以降は macOS 12 以降が必須。[ChromeStatus](https://chromestatus.com/feature/4504090090143744)
- **HTML での `ISO-2022-JP` 文字セット自動検出削除**: セキュリティ上の既知問題により削除。明示的な charset 指定を推奨。[ChromeStatus](https://chromestatus.com/feature/6576566521561088)
- **`Purpose: prefetch` ヘッダーの送信停止予定**: `Sec-Purpose` ヘッダーへの移行進行中。[ChromeStatus](https://chromestatus.com/feature/5088012836536320)

---

### 導入指針メモ
- **CSS**: カスタム関数は既存の CSS 変数と併用可能。段階的導入を推奨。squircle は iOS 風デザインに最適で、アニメーション対応により動的な UI 表現が可能
- **Web API**: オンデバイス音声認識は利用可能性確認（`canUseLocalRecognition`）を必ず実装。フォールバックとしてクラウド版を用意すること
- **AI**: Prompt API は Origin Trial 段階。本番利用は慎重に。プライバシーポリシーでローカル推論の明記を。ユーザーデータの取り扱いに注意
- **セキュリティ**: Accept-Language や window.name の変更は自動適用。既存実装への影響を確認。window.name 依存コードは sessionStorage/localStorage への移行を
- **Web アプリ**: scope_extensions は複数ドメイン運用時に有効。オリジン間の認証設計（Cookie、CORS、セキュリティヘッダー）を再確認すること
- **非推奨対応**: macOS 11 サポート終了。該当ユーザーへの通知と OS アップグレード支援を実施。ISO-2022-JP 使用サイトは明示的な charset 指定を追加
- **Origin Trial**: 各機能の試験運用期間と制限を ChromeStatus で確認。本番採用前にフィードバックを提供し、仕様変更に備えること
