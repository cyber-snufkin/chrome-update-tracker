# 🧭 Chrome 138 更新チェック（Stable＋コードサンプル付き）

- リリース日: 2025-06-24（Stable）
- 一次情報:
  - [Release Notes](https://developer.chrome.com/release-notes/138)
  - [New in Chrome 138](https://developer.chrome.com/blog/new-in-chrome-138)
  - [New in DevTools 138](https://developer.chrome.com/blog/new-in-devtools-138)
  - [Chrome Releases: Stable Channel Update for Desktop (Jun 24, 2025)](https://chromereleases.googleblog.com/2025/06/stable-channel-update-for-desktop_24.html)
  - [Chrome Releases: Stable Channel Update for Desktop (Jun 30, 2025)](https://chromereleases.googleblog.com/2025/06/stable-channel-update-for-desktop_30.html)
  - [Chrome Releases: Chrome for Android update (Jun 30, 2025)](https://chromereleases.googleblog.com/2025/06/)
  - [ChromeStatus Roadmap](https://chromestatus.com/roadmap)
  - [MDN](https://developer.mozilla.org/ja/docs/Web) / [Can I use](https://caniuse.com/)
  - [Baseline](https://web.dev/baseline?hl=ja)

---

## 🔹 全体サマリ
- **CSS 数学関数**: `abs()`, `sign()`、補間関数 `progress()` を追加
- **CSS**: 兄弟位置/数に基づく `sibling-index()` / `sibling-count()`、`stretch` キーワード
- **Web API**: **Translator API** / **Language Detector API**（言語検出＆翻訳）
- **デバイス**: **Web Serial over Bluetooth (Android)**、**Viewport Segments API**（折りたたみ端末）
- **WebCodecs**: VideoFrame に **回転/反転**メタデータ対応（エンコード/デコード経路）
- **パフォーマンス**: `Clear-Site-Data` に "prefetchCache" / "prerenderCache" 追加、**Speculation Rules** に `target_hint`
- **セキュリティ**: **Integrity-Policy** ヘッダー（SRIの徹底適用）
- **Service Worker**: Speculation Rules の Prefetch を SW で処理・キャッシュ
- **デプリケーション**: WebGPU `GPUAdapter.isFallbackAdapter` を廃止（`GPUAdapterInfo.isFallbackAdapter` へ）

### 🚨 重要度の高いもの
- **Integrity-Policy** により **SRI未指定のスクリプト読み込みを一律拒否**できる（CSPと併用で供給網保護）
- **Translator / Language Detector API** により**オンデバイス翻訳/言語推定**をJSから呼び出し可能（企業ポリシーで無効化可）
- **Speculation Rules** の `target_hint` と **Clear-Site-Data** 拡張で**プリレンダー運用の可視性/制御**が向上

---

## 🧩 HTML / DOM
- 本版で大きなHTML要素追加はなし。Viewport Segments APIは **CSS/JS 連携**で対応（下記）。

---

## 🎨 CSS
### `abs()` / `sign()` / `progress()`（CSS数学関数）
```css
.box {
  /* 絶対値で閾値を切る例 */
  --dx: calc(var(--x) - 50%);
  translate: calc(abs(var(--dx))) 0;
}

.badge {
  /* 方向を sign() で反転 */
  transform: translateX(calc(sign(var(--dir)) * 1rem));
}

.progressbar {
  /* progress( value between start..end ) → 0..1 の数値 */
  --p: progress(var(--cur) var(--start) var(--end));
  background: linear-gradient(to right, currentColor calc(var(--p) * 100%), #0000 0);
}
```

### 兄弟の位置/数でスタイル: `sibling-index()` / `sibling-count()`
```css
.list > li::before {
  content: counter(item, decimal-leading-zero, sibling-index());
}
.list > li {
  /* 最後尾だけマージンを0に */
  margin-block-end: calc(1rem * (sibling-index() < sibling-count()));
}
```

### 伸長キーワード `stretch`
```css
img {
  inline-size: stretch; /* コンテナに対して自然な伸長挙動 */
}
```

---

## ⚙️ JavaScript (V8)
- 直接の言語仕様追加は目立たず（V8更新・セキュリティFixはリリースノート参照）。

---

## 🧠 AI in Chrome
### Translator API（翻訳） / Language Detector API（言語検出）
```js
// 例: 入力テキストの言語を推定→日本語へ翻訳
const detector = new LanguageDetector();
const { language, confidence } = await detector.detect("Ciao mondo!");

if (confidence > 0.7) {
  const translator = new Translator(language, 'ja');
  const out = await translator.translate("Ciao mondo!");
  console.log(out); // "こんにちは世界！"
}
```
> 備考: 企業ポリシー `GenAILocalFoundationalModelSettings` により**モデルDLを禁止**すると当APIは利用不可。

---

## 🧰 DevTools
- 本版の主眼は**プリフェッチ/プリレンダー可視化**や**AI支援**の継続改善（詳細は DevTools 138 を参照）。

---

## 🌐 Web API（その他）
### Web Serial over Bluetooth（Android）
```js
// AndroidでのRFCOMMシリアルに接続（権限はWeb Bluetoothと同様にプロンプト）
const port = await navigator.serial.requestPort({
  filters: [{ bluetooth: { uuid: '00001101-0000-1000-8000-00805f9b34fb' } }]
});
await port.open({ baudRate: 115200 });
```

### Viewport Segments API（折りたたみ端末のレイアウト）
```css
@media (spanning: single-fold-vertical) {
  .pane { inline-size: env(viewport-segment-width 0 0); }
}
```
```js
// JSでもセグメントを列挙
for (const seg of (window.getWindowSegments?.() ?? [])) {
  console.log(seg.left, seg.top, seg.width, seg.height);
}
```

### WebCodecs: VideoFrame の orientation メタデータ
```js
// 回転・反転を付与して VideoFrame を生成
const vf = new VideoFrame(canvas, { timestamp: 0, rotation: 90, flip: true });
encoder.encode(vf);
```

### Clear-Site-Data の拡張（prefetch/prerender）
```http
Clear-Site-Data: "\"cookies\"", "\"storage\"", "\"prefetchCache\"", "\"prerenderCache\""
```

### Speculation Rules: `target_hint`
```json
{
  "prefetch": [{ "source": "list", "urls": ["/next"] }],
  "prerender": [{ "source": "document", "where": { "href_matches": "/product/.*" },
    "target_hint": "_blank"
  }]
}
```

### Integrity-Policy ヘッダー
```http
Integrity-Policy: require-script-integrity; report-to=default
```

### Service Worker: Speculation Rules Prefetch のサポート
```js
// 事前フェッチを SW が横取り→prefetch cache に保存
self.addEventListener('fetch', (e) => {
  // e.request.mode === 'no-cors' 等、ルールに応じて分岐
  // ここで応答を生成し、prefetch cache にも反映される
});
```

---

## 🧾 セキュリティ更新
- 初回安定: **138.0.7204.49/50（2025-06-24）**。ロールアップ: **.92/.93（2025-06-30）** ほか。
- 例: V8起因の**Type Confusion**（CVE-2025-6554）等を修正。

---

### 導入指針メモ
- **SRIの徹底**: `Integrity-Policy` をCSPと併用し、CDN/供給網からの改竄リスクを低減。レポートエンドポイントを必ず設定。
- **翻訳/言語検出**: `Translator`/`LanguageDetector` は**入力ログの扱い**を明確化（PII混入に注意）。企業ポリシーに留意。
- **プリレンダー運用**: `target_hint` と `Clear-Site-Data` 拡張で**予測遷移のキャッシュ制御**を標準化。A/B 実験で効果測定。
- **レイアウト**: 折りたたみ端末向けに Viewport Segments API を試験導入（CSS/env と JS 列挙の併用）。
- **動画処理**: WebCodecs の orientation を使った回転/反転の取り扱いをパイプラインへ明文化。
