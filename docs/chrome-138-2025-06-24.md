# 🧭 Chrome 138 更新チェック（Stable＋コードサンプル付き）

- リリース日: 2025-06-24（Stable）
- 一次情報:
  - [Release Notes](https://developer.chrome.com/release-notes/138)
  - [New in Chrome 138](https://developer.chrome.com/blog/new-in-chrome-138)
  - [New in DevTools 138](https://developer.chrome.com/blog/new-in-devtools-138)
  - [Chrome Releases: Stable Channel Update for Desktop (Jun 24, 2025)](https://chromereleases.googleblog.com/2025/06/stable-channel-update-for-desktop_24.html)
  - [Chrome Releases: Stable Channel Update for Desktop (Jun 30, 2025)](https://chromereleases.googleblog.com/2025/06/stable-channel-update-for-desktop_30.html)
  - [Chrome Releases: Chrome for Android update (Jun 30, 2025)](https://chromereleases.googleblog.com/2025/06/)
  - [ChromeStatus Roadmap](https://chromestatus.com/roadmap)
  - [MDN](https://developer.mozilla.org/ja/docs/Web) / [Can I use](https://caniuse.com/)
  - [Baseline](https://web.dev/baseline?hl=ja)

---

## 🔹 全体サマリ
- **CSS 数学関数**: `abs()`, `sign()`, `progress()` を追加
- **CSS**: `sibling-index()` / `sibling-count()`、`stretch` キーワード
- **Web API**: **Translator API** / **Language Detector API**（言語検出＆翻訳）
- **デバイス**: **Web Serial over Bluetooth (Android)**、**Viewport Segments API**（折りたたみ端末）
- **パフォーマンス**: `Clear-Site-Data` に "prefetchCache" / "prerenderCache" 追加、**Speculation Rules** に `target_hint`
- **セキュリティ**: **Integrity-Policy** ヘッダー（SRI徹底適用）
- **その他**: WebCodecs orientation、Service WorkerのPrefetch処理、V8 Type Confusion修正 など

---

## 🧭 新用語リファレンス（Chrome 138で新登場／重要化した概念）

| 用語 | 概要 | 関連領域 |
|------|------|-----------|
| **Integrity-Policy** | サーバーヘッダーで、SRI未指定のスクリプトやリソースを拒否するセキュリティポリシー。CSPと併用することで供給網改ざんを防ぐ。 | セキュリティ / HTTPヘッダー |
| **デプリケーション (Deprecation)** | 今後削除予定の機能を段階的に無効化。例: `GPUAdapter.isFallbackAdapter` 廃止。 | 仕様移行 / API整備 |
| **Speculation Rules** | `<script type="speculationrules">` によって事前読み込み/描画ルールを指定。`prefetch`・`prerender`を制御できる。 | パフォーマンス / プリレンダー |
| **Clear-Site-Data 拡張** | 新オプション `"prefetchCache"` / `"prerenderCache"` により、事前読み込みキャッシュを明示削除。 | キャッシュ制御 / パフォーマンス |
| **プリフェッチ・プリレンダー** | ページ遷移前に次ページを事前取得/描画。ユーザー体験を高速化。Speculation Rulesで統合管理可能。 | パフォーマンス / UX |
| **AndroidでのRFCOMMシリアル** | Bluetooth経由でシリアル通信（RFCOMM）を行う仕組み。Web Serial APIの拡張。 | デバイス連携 / Web Bluetooth |
| **Type Confusion** | 変数型を誤って扱う脆弱性。V8などJIT環境で発生しやすい。CVE対象例あり。 | セキュリティ / メモリ安全 |
| **SRI (Subresource Integrity)** | `<script>` や `<link>` にハッシュを付与して改ざん検出を行う仕組み。Integrity-Policyと併用される。 | セキュリティ |
| **PII混入 (Personally Identifiable Information)** | 個人情報（氏名・住所など）がAIモデル入力やログに含まれる状態。Translator/LanguageDetector等で注意。 | プライバシー / AI |

---

## 🧩 HTML / DOM
- 本版で大きなHTML要素追加はなし。Viewport Segments APIは **CSS/JS 連携**で対応（下記）。

---

## 🎨 CSS
### `abs()` / `sign()` / `progress()`（CSS数学関数）
```css
.box {
  --dx: calc(var(--x) - 50%);
  translate: calc(abs(var(--dx))) 0;
}
.badge {
  transform: translateX(calc(sign(var(--dir)) * 1rem));
}
.progressbar {
  --p: progress(var(--cur) var(--start) var(--end));
  background: linear-gradient(to right, currentColor calc(var(--p) * 100%), #0000 0);
}
```

### 兄弟の位置/数でスタイル: `sibling-index()` / `sibling-count()`
```css
.list > li::before {
  content: counter(item, decimal-leading-zero, sibling-index());
}
.list > li {
  margin-block-end: calc(1rem * (sibling-index() < sibling-count()));
}
```

### 伸長キーワード `stretch`
```css
img { inline-size: stretch; }
```

---

## ⚙️ JavaScript (V8)
- 言語仕様追加はなし（V8更新・セキュリティFixはリリースノート参照）。

---

## 🧠 AI in Chrome
### Translator API / Language Detector API
```js
const detector = new LanguageDetector();
const { language, confidence } = await detector.detect('Ciao mondo!');
if (confidence > 0.7) {
  const translator = new Translator(language, 'ja');
  const out = await translator.translate('Ciao mondo!');
  console.log(out); // こんにちは世界！
}
```
> 備考: 企業ポリシー `GenAILocalFoundationalModelSettings` によりモデルDLを禁止すると当APIは利用不可。

---

## 🧰 DevTools
- 本版の主眼はプリフェッチ/プリレンダー可視化およびAI支援の継続改善。詳細は DevTools 138 を参照。

---

## 🌐 Web API
### Web Serial over Bluetooth (Android)
```js
const port = await navigator.serial.requestPort({
  filters: [{ bluetooth: { uuid: '00001101-0000-1000-8000-00805f9b34fb' } }]
});
await port.open({ baudRate: 115200 });
```
### Viewport Segments API（折りたたみ端末）
```css
@media (spanning: single-fold-vertical) {
  .pane { inline-size: env(viewport-segment-width 0 0); }
}
```
```js
for (const seg of (window.getWindowSegments?.() ?? [])) {
  console.log(seg.left, seg.top, seg.width, seg.height);
}
```
### WebCodecs: VideoFrame orientation
```js
const vf = new VideoFrame(canvas, { timestamp: 0, rotation: 90, flip: true });
encoder.encode(vf);
```
### Clear-Site-Data 拡張
```http
Clear-Site-Data: "\"cookies\"", "\"storage\"", "\"prefetchCache\"", "\"prerenderCache\""
```
### Speculation Rules: target_hint
```json
{
  "prefetch": [{ "source": "list", "urls": ["/next"] }],
  "prerender": [{ "source": "document", "where": { "href_matches": "/product/.*" },
    "target_hint": "_blank"
  }]
}
```
### Integrity-Policy ヘッダー
```http
Integrity-Policy: require-script-integrity; report-to=default
```
### Service Worker: Speculation Rules Prefetch
```js
self.addEventListener('fetch', (e) => {
  // e.request.mode === 'no-cors' など条件により分岐
});
```

---

## 🧾 セキュリティ更新
- 初回安定: 138.0.7204.49/50（2025-06-24）。ロールアップ: .92/.93（2025-06-30）ほか。
- 例: V8 Type Confusion（CVE-2025-6554）修正。

---

### 導入指針メモ
- **SRIの徹底**: Integrity-Policy をCSPと併用し、改ざん防止。レポートエンドポイント設定推奨。
- **翻訳/言語検出**: Translator/LanguageDetector のログ扱いを明確化（PII混入に注意）。
- **プリレンダー運用**: target_hint + Clear-Site-Data で事前遷移キャッシュを標準化。
- **レイアウト**: Viewport Segments API を折りたたみ端末向けに試験導入。
- **動画処理**: WebCodecs orientation をパイプライン定義へ明文化。
